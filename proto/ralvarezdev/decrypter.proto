syntax = "proto3";

package ralvarezdev;

import "google/protobuf/empty.proto";

service Decrypter {
  rpc ReceiveEncryptedFile(stream ReceiveEncryptedFileRequest) returns (google.protobuf.Empty);
  rpc RemoveEncryptedFile(RemoveEncryptedFileRequest) returns (google.protobuf.Empty);
  rpc RemoveEncryptedFiles(google.protobuf.Empty) returns (google.protobuf.Empty);
  rpc ListActiveFiles(google.protobuf.Empty) returns (ListActiveFilesResponse);
  rpc DecryptFile(DecryptFileRequest) returns (stream DecryptFileResponse);
}

message ReceiveEncryptedFileRequest {
    string filename = 1;
    bytes encrypted_content = 2;
    bytes content_signature = 3;
}

message RemoveEncryptedFileRequest {
    string filename = 1;
    string common_name = 2;
}

message CompanyFiles {
    string common_name = 1;
    repeated string filenames = 2;
}

message ListActiveFilesResponse {
    repeated CompanyFiles company_files = 1;
}

message DecryptFileRequest {
    string filename = 1;
}

message DecryptFileResponse {
    bytes file_content = 1;
}